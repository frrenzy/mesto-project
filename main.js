(()=>{"use strict";var e=function(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))},t=function(t){document.removeEventListener("keydown",e),t.classList.remove("popup_opened")},n=function(t){t.classList.add("popup_opened"),document.addEventListener("keydown",e)},r=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";e.querySelector(".popup__submit").textContent=t?"Сохранение...":n},i=document.querySelector(".pics__grid"),o=document.querySelector(".profile__name"),a=document.querySelector(".profile__description"),c=document.querySelector(".profile__pic"),l=document.querySelector(".profile__edit-avatar"),s=document.forms.edit,u=document.forms.add,d=document.forms.avatar,p=document.forms.delete,f=s.elements.name,h=s.elements.description,v={profilePopupElement:document.querySelector(".popup_type_profile"),cardPopupElement:document.querySelector(".popup_type_card"),picturePopupElement:document.querySelector(".popup_type_picture"),avatarPopupElement:document.querySelector(".popup_type_avatar"),deletePopupElement:document.querySelector(".popup_type_delete")},m=v.picturePopupElement.querySelector(".popup__picture"),y=v.picturePopupElement.querySelector(".popup__title"),_=window.localStorage;function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){E(e,t),t.add(e)}function k(e,t,n){E(e,t),t.set(e,n)}function E(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function S(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function g(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,C(e,t,"get"))}function L(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,C(e,t,"set"),n),n}function C(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var q=new WeakMap,P=new WeakMap,O=new WeakMap,T=new WeakMap,j=new WeakMap,x=new WeakMap,A=new WeakMap,W=new WeakMap,I=new WeakMap,M=new WeakSet,D=new WeakSet,B=new WeakSet,U=new WeakSet,N=new WeakSet,z=function(){function e(t,n,r){var i=t.name,o=t.link,a=t._id,c=t.likes,l=t.owner,s=n.addLike,u=n.deleteLike;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),w(this,N),w(this,U),w(this,B),w(this,D),w(this,M),k(this,q,{writable:!0,value:void 0}),k(this,P,{writable:!0,value:void 0}),k(this,O,{writable:!0,value:void 0}),k(this,T,{writable:!0,value:void 0}),k(this,j,{writable:!0,value:void 0}),k(this,x,{writable:!0,value:void 0}),k(this,A,{writable:!0,value:void 0}),k(this,W,{writable:!0,value:void 0}),k(this,I,{writable:!0,value:void 0}),L(this,O,o),L(this,P,i),L(this,q,r),L(this,x,l),L(this,T,a),L(this,j,c),L(this,W,s),L(this,I,u)}var t,n;return t=e,(n=[{key:"renderCard",value:function(){var e=S(this,N,G).call(this);i.prepend(e)}}])&&b(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function J(){return document.querySelector(g(this,q)).content.querySelector("li").cloneNode(!0)}function H(e,t){e.classList.contains("pics__like_active")?g(this,I).call(this,g(this,T)).then((function(n){e.classList.remove("pics__like_active"),t.textContent=n.likes.length})).catch(console.log):g(this,W).call(this,g(this,T)).then((function(n){e.classList.add("pics__like_active"),t.textContent=n.likes.length})).catch(console.log)}function $(){_.setItem("cardId",g(this,T)),n(v.deletePopupElement)}function F(e,t,r,i){var o=this;e.addEventListener("click",(function(){var t;t=e,m.src=t.src,m.alt=t.alt,y.textContent=t.alt,n(v.picturePopupElement)})),i.addEventListener("click",(function(){S(o,D,H).call(o,i,r,g(o,T))})),t.addEventListener("click",(function(){S(o,B,$).call(o)}))}function G(){L(this,A,S(this,M,J).call(this));var e=g(this,A).querySelector(".pics__pic"),t=g(this,A).querySelector(".pics__delete"),n=g(this,A).querySelector(".pics__like"),r=g(this,A).querySelector(".pics__like-counter");return e.src=g(this,O),e.alt=g(this,P),e.dataset.id=g(this,T),r.textContent=g(this,j).length,g(this,A).querySelector(".pics__pic-name").textContent=g(this,P),g(this,j).find((function(e){return e.id===_.getItem("profileId")}))&&n.classList.add("pics__like_active"),g(this,x)._id!==_.getItem("profileId")&&t.classList.add("pics__delete_hidden"),S(this,U,F).call(this,e,t,r,n),g(this,A)}var K=["inputSelector","submitButtonSelector","inactiveButtonClass"];function Q(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var R=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled")):(t.classList.add(n),t.setAttribute("disabled",""))};function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function X(e,t,n){Y(e,t),t.set(e,n)}function Y(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Z(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function ee(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,ne(e,t,"get"))}function te(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,ne(e,t,"set"),n),n}function ne(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var re=new WeakMap,ie=new WeakMap,oe=new WeakSet;function ae(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}const ce=new(function(){function e(t){var n,r=t.baseUrl,i=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Y(this,n=oe),n.add(this),X(this,re,{writable:!0,value:void 0}),X(this,ie,{writable:!0,value:void 0}),te(this,re,r),te(this,ie,i)}var t,n;return t=e,(n=[{key:"getUser",value:function(){return fetch("".concat(ee(this,re),"/users/me"),{headers:ee(this,ie)}).then(Z(this,oe,ae))}},{key:"getCards",value:function(){return fetch("".concat(ee(this,re),"/cards"),{headers:ee(this,ie)}).then(Z(this,oe,ae))}},{key:"editProfile",value:function(e){return fetch("".concat(ee(this,re),"/users/me"),{method:"PATCH",body:JSON.stringify(e),headers:ee(this,ie)}).then(Z(this,oe,ae))}},{key:"addCard",value:function(e){return fetch("".concat(ee(this,re),"/cards"),{method:"POST",body:JSON.stringify(e),headers:ee(this,ie)}).then(Z(this,oe,ae))}},{key:"deleteCard",value:function(e){return fetch("".concat(ee(this,re),"/cards/").concat(e),{method:"DELETE",headers:ee(this,ie)}).then(Z(this,oe,ae))}},{key:"addLike",value:function(e){return fetch("".concat(ee(this,re),"/cards/likes/").concat(e),{method:"PUT",headers:ee(this,ie)}).then(Z(this,oe,ae))}},{key:"deleteLike",value:function(e){return fetch("".concat(ee(this,re),"/cards/likes/").concat(e),{method:"DELETE",headers:ee(this,ie)}).then(Z(this,oe,ae))}},{key:"editAvatar",value:function(e){return fetch("".concat(ee(this,re),"/users/me/avatar"),{method:"PATCH",body:JSON.stringify({avatar:e}),headers:ee(this,ie)}).then(Z(this,oe,ae))}}])&&V(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-13",headers:{authorization:"0347b600-c1ce-41de-a88e-cd44ae7745f0","Content-Type":"application/json"}});function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var se,ue,de,pe=v.cardPopupElement,fe=v.profilePopupElement,he=v.avatarPopupElement,ve=v.deletePopupElement;Promise.all([ce.getUser(),ce.getCards()]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){c=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw i}}return o}}(t,n)||function(e,t){if(e){if("string"==typeof e)return le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?le(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=r[0],l=r[1];o.textContent=i.name,a.textContent=i.about,c.src=i.avatar,_.setItem("profileId",i._id),l.reverse().forEach((function(e){new z(e,{addLike:function(e){return ce.addLike(e)},deleteLike:function(e){return ce.deleteLike(e)}},"#pic-template").renderCard()}))})).catch(console.log),document.querySelector(".profile__add").addEventListener("click",(function(){n(pe)})),document.querySelector(".profile__edit").addEventListener("click",(function(){f.value=o.textContent,h.value=a.textContent,n(v.profilePopupElement)})),l.addEventListener("click",(function(){n(he)})),u.addEventListener("submit",(function(e){e.preventDefault(),r(u,!0),ce.addCard({name:u.elements.name.value,link:u.elements.link.value}).then((function(e){new z(e,{addLike:function(e){return ce.addLike(e)},deleteLike:function(e){return ce.deleteLike(e)}},"#pic-template").renderCard(),u.reset(),t(pe)})).catch(console.log).finally((function(){r(u,!1,"Создать")}))})),s.addEventListener("submit",(function(e){e.preventDefault(),r(s,!0),ce.editProfile({name:s.elements.name.value,about:s.elements.description.value}).then((function(e){o.textContent=e.name,a.textContent=e.about,t(fe)})).catch(console.log).finally((function(){r(s,!1)}))})),d.addEventListener("submit",(function(e){e.preventDefault(),r(d,!0),ce.editAvatar(d.elements.link.value).then((function(e){c.src=e.avatar,t(he)})).catch(console.log).finally((function(){r(d,!1)}))})),p.addEventListener("submit",(function(e){e.preventDefault(),r(p,!0);var n=_.getItem("cardId");ce.deleteCard(n).then((function(e){document.querySelector('.pics__pic[data-id="'.concat(n,'"]')).closest("li").remove(),t(ve)})).catch(console.log).finally((function(){r(p,!1,"Да")}))})),Array.from(Object.values(v)).forEach((function(e){e.addEventListener("mousedown",(function(n){n.target.classList.contains("popup_opened")&&t(e),n.target.classList.contains("popup__close")&&t(e)}))})),ue=(se={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}).formSelector,de=Q(se,["formSelector"]),Array.from(document.querySelectorAll(ue)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=t.inputSelector,r=t.submitButtonSelector,i=t.inactiveButtonClass,o=Q(t,K),a=Array.from(e.querySelectorAll(n)),c=e.querySelector(r);R(a,c,i),e.addEventListener("submit",(function(){R(a,c,i)})),a.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=t.validationMessage,r.classList.add(n.errorClass)}(e,t,n)}(e,t,o),R(a,c,i)}))}))}(e,de)}))})();